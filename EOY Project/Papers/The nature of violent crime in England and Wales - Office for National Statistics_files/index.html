<!DOCTYPE html>
<!-- saved from url=(0416)https://www.ons.gov.uk/visualisations/dvc1168/simple_pyramid_and_line/index.html?initialWidth=700&childId=788-4bb8-88e6-6f4978beb102&parentTitle=The%20nature%20of%20violent%20crime%20in%20England%20and%20Wales%20-%20Office%20for%20National%20Statistics&parentUrl=https%3A%2F%2Fwww.ons.gov.uk%2Fpeoplepopulationandcommunity%2Fcrimeandjustice%2Farticles%2Fthenatureofviolentcrimeinenglandandwales%2Fyearendingmarch2020 -->
<html lang="en" class="embedded"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="./css" rel="stylesheet" type="text/css">
<title>LGB population pyramid</title>
<meta name="description" content="">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="./globalStyle.css">
<style type="text/css">

#graphic .axis path{
  stroke:none;
}

body,
    tspan,
    label {
      font-family: 'Open Sans', sans-serif;
    }
    h6 {
      font-size: 16px;
      margin: 16px 0 8px 0;
      font-weight: 700;
      color: #323132;
    }
    #chartHeading {
      font-size: 14px;
      font-weight:600;
    }
    ul, ol {
  margin: 0px 0;
  padding-left: 16px;
}
li {
  font-size: 14px;
  font-weight: 400;
  line-height: 24px;
  margin: 0px 0;
  padding: 6px 0 10px 16px;
}
h5 {
 font-size: 16px;
 margin: 16px 0 8px 0;
 font-weight: 700;
 color:#323132;
}

.mfLabel{
  font-size: 16px;
  font-weight: 700;
  color: #323132;
}


#graphic .axis {
    font-family: 'Open Sans';
}

.visuallyhidden {
   position: absolute;
   width: 1px;
   height: 1px;
   margin: -1px;
   padding: 0;
   overflow: hidden;
   clip: rect(0, 0, 0, 0);
   border: 0;
 }

    </style>
</head>
<body marginheight="0">
<div class="visuallyhidden">
<h5 id="screenreadertext">The chart canvas is hidden from screen readers. The main message is summarised by the chart title and the data behind the chart is available to download below.</h5>
</div>
<div id="graphic" aria-hidden="true"><svg width="650" height="595"><g id="legend"><g><rect class="rect0" fill="#537c9b" x="0" y="5" width="15" height="15"></rect><text class="legend0" text-anchor="start" y="20" x="25" style="font-size: 14px; fill: rgb(102, 102, 102);">Percentage of male victims</text></g><g><rect class="rect1" fill="#69d2cd" x="225.287109375" y="5" width="15" height="15"></rect><text class="legend1" text-anchor="start" y="20" x="250.287109375" style="font-size: 14px; fill: rgb(102, 102, 102);">Percentage of female victims</text></g><g><rect class="rect2" fill="#053D58" x="0" y="32" width="15" height="3"></rect><text class="legend2" text-anchor="start" y="40" x="25" style="font-size: 14px; fill: rgb(102, 102, 102);">Percentage of male population</text></g><g><rect class="rect3" fill=" #24a79b" x="250.5625" y="32" width="15" height="3"></rect><text class="legend3" text-anchor="start" y="40" x="275.5625" style="font-size: 14px; fill: rgb(102, 102, 102);">Percentage of female population</text></g></g><g width="255.00000000000003" height="510" transform="translate(10,60)"><rect class="svgRect" width="225.00000000000003" height="510"></rect><g class="x axis" transform="translate(0, 510)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M225.50000000000003,-510V0.5H0.5V-510"></path><g class="tick" opacity="1" transform="translate(225.50000000000003,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">0</text></g><g class="tick" opacity="1" transform="translate(197.37500000000003,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">1</text></g><g class="tick" opacity="1" transform="translate(169.25000000000003,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">2</text></g><g class="tick" opacity="1" transform="translate(141.125,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">3</text></g><g class="tick" opacity="1" transform="translate(113.00000000000001,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">4</text></g><g class="tick" opacity="1" transform="translate(84.875,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">5</text></g><g class="tick" opacity="1" transform="translate(56.75,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">6</text></g><g class="tick" opacity="1" transform="translate(28.625,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">7</text></g><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">8</text></g></g><g class="bars"><rect class="barL" width="2.2185566718750067" x="222.78144332812502" y="0" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="3.370137975000006" x="221.62986202500002" y="25.62814070351759" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="6.049327162499992" x="218.95067283750004" y="51.25628140703518" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="9.73908770624999" x="215.26091229375004" y="76.88442211055278" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="18.237287784375013" x="206.76271221562502" y="102.51256281407036" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="25.706115196875004" x="199.29388480312502" y="128.14070351758795" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="38.345307693750016" x="186.65469230625" y="153.76884422110555" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="64.09372587187502" x="160.906274128125" y="179.39698492462313" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="89.16059593125001" x="135.83940406875" y="205.02512562814073" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="105.80917154062502" x="119.19082845937501" y="230.65326633165833" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="106.974853846875" x="118.02514615312502" y="256.2814070351759" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="129.160420453125" x="95.83957954687503" y="281.9095477386935" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="149.53635925312503" x="75.463640746875" y="307.5376884422111" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="158.21317195312503" x="66.786828046875" y="333.1658291457287" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="147.59982250312504" x="77.40017749687499" y="358.79396984924625" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="124.04645932500003" x="100.953540675" y="384.42211055276385" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="91.19583964687502" x="133.804160353125" y="410.05025125628146" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="35.243088637499994" x="189.75691136250003" y="435.67839195979906" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="13.875379790625004" x="211.12462020937502" y="461.30653266331666" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect><rect class="barL" width="5.9412195281250035" x="219.05878047187502" y="486.9346733668342" height="23.06532663316583" fill="#537c9b" style="opacity: 0.9;"></rect></g><g id="l_Outlines" transform="translate(0,0)"><path id="outlineL" stroke="#053D58" fill="none" stroke-width="2px" d="M 216.67580091562502 0 L 216.67580091562502 0 L 216.67580091562502 25.62814070351759L 207.38652938437502 25.62814070351759 L 207.38652938437502 51.25628140703518L 193.05371826562504 51.25628140703518 L 193.05371826562504 76.88442211055278L 179.56588964062502 76.88442211055278 L 179.56588964062502 102.51256281407036L 157.96229220000004 102.51256281407036 L 157.96229220000004 128.14070351758795L 156.79934114062502 128.14070351758795 L 156.79934114062502 153.76884422110555L 148.293019884375 153.76884422110555 L 148.293019884375 179.39698492462313L 134.36576060625003 179.39698492462313 L 134.36576060625003 205.02512562814073L 128.74732250625001 205.02512562814073 L 128.74732250625001 230.65326633165833L 133.3818561375 230.65326633165833 L 133.3818561375 256.2814070351759L 140.59363845937503 256.2814070351759 L 140.59363845937503 281.9095477386935L 133.18061799375002 281.9095477386935 L 133.18061799375002 307.5376884422111L 130.51701624375002 307.5376884422111 L 130.51701624375002 333.1658291457287L 128.489682796875 333.1658291457287 L 128.489682796875 358.79396984924625L 135.14246505 358.79396984924625 L 135.14246505 384.42211055276385L 145.64900725312503 384.42211055276385 L 145.64900725312503 410.05025125628146L 139.25405396250002 410.05025125628146 L 139.25405396250002 435.67839195979906L 134.78219533125002 435.67839195979906 L 134.78219533125002 461.30653266331666L 156.66765862500003 461.30653266331666 L 156.66765862500003 486.9346733668342L 209.20732520625003 486.9346733668342 L 209.20732520625003 510"></path></g></g><g width="267.7358490566038" height="510" transform="translate(287.7358490566038,60)"><rect class="svgRect" width="237.73584905660377" height="510"></rect><g class="x axis" transform="translate(0, 510)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,-510V0.5H225.50000000000003V-510"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">0</text></g><g class="tick" opacity="1" transform="translate(28.625000000000004,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">1</text></g><g class="tick" opacity="1" transform="translate(56.75000000000001,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">2</text></g><g class="tick" opacity="1" transform="translate(84.87500000000001,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">3</text></g><g class="tick" opacity="1" transform="translate(113.00000000000001,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">4</text></g><g class="tick" opacity="1" transform="translate(141.12500000000003,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">5</text></g><g class="tick" opacity="1" transform="translate(169.25000000000003,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">6</text></g><g class="tick" opacity="1" transform="translate(197.37500000000003,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">7</text></g><g class="tick" opacity="1" transform="translate(225.50000000000003,0)"><line stroke="#000" y2="-510"></line><text fill="#000" y="3" dy="0.71em">8</text></g></g><g class="y axis" transform="translate(-15.333333333333334,0)" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><g class="tick" opacity="1" transform="translate(0,11.532663316582916)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>90+</tspan></text></g><g class="tick" opacity="1" transform="translate(0,37.16080402010051)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>85-89</tspan></text></g><g class="tick" opacity="1" transform="translate(0,62.7889447236181)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>80-84</tspan></text></g><g class="tick" opacity="1" transform="translate(0,88.41708542713569)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>75-79</tspan></text></g><g class="tick" opacity="1" transform="translate(0,114.04522613065328)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>70-74</tspan></text></g><g class="tick" opacity="1" transform="translate(0,139.67336683417088)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>65-69</tspan></text></g><g class="tick" opacity="1" transform="translate(0,165.30150753768848)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>60-64</tspan></text></g><g class="tick" opacity="1" transform="translate(0,190.92964824120605)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>55-59</tspan></text></g><g class="tick" opacity="1" transform="translate(0,216.55778894472365)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>50-54</tspan></text></g><g class="tick" opacity="1" transform="translate(0,242.18592964824126)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>45-49</tspan></text></g><g class="tick" opacity="1" transform="translate(0,267.8140703517588)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>40-44</tspan></text></g><g class="tick" opacity="1" transform="translate(0,293.4422110552764)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>35-39</tspan></text></g><g class="tick" opacity="1" transform="translate(0,319.070351758794)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>30-34</tspan></text></g><g class="tick" opacity="1" transform="translate(0,344.6984924623116)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>25-29</tspan></text></g><g class="tick" opacity="1" transform="translate(0,370.32663316582915)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>20-24</tspan></text></g><g class="tick" opacity="1" transform="translate(0,395.95477386934675)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>15-19</tspan></text></g><g class="tick" opacity="1" transform="translate(0,421.58291457286435)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>10-14</tspan></text></g><g class="tick" opacity="1" transform="translate(0,447.21105527638196)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>5-9</tspan></text></g><g class="tick" opacity="1" transform="translate(0,472.83919597989956)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>1-4</tspan></text></g><g class="tick" opacity="1" transform="translate(0,498.4673366834171)" style="font-size: 14px;"><text fill="#000" x="-9" dy="0.32em" style="text-anchor: middle; fill: rgb(102, 102, 102);"><tspan>&lt;1</tspan></text></g></g><g class="bars"><rect class="barR" width="4.4606149875000005" x="0" y="0" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="5.184466087500001" x="0" y="25.62814070351759" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="7.1774068218750005" x="0" y="51.25628140703518" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="9.616879068750002" x="0" y="76.88442211055278" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="15.238476028125003" x="0" y="102.51256281407036" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="19.525178728125002" x="0" y="128.14070351758795" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="30.763672312500002" x="0" y="153.76884422110555" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="55.05028728750001" x="0" y="179.39698492462313" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="88.958481665625" x="0" y="205.02512562814073" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="115.69396952812501" x="0" y="230.65326633165833" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="124.77971112187501" x="0" y="256.2814070351759" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="161.87943085312503" x="0" y="281.9095477386935" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="191.25650525625002" x="0" y="307.5376884422111" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="208.73703962812502" x="0" y="333.1658291457287" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="190.80057307500002" x="0" y="358.79396984924625" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="142.98409659375" x="0" y="384.42211055276385" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="76.48380078750002" x="0" y="410.05025125628146" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="24.22551065625" x="0" y="435.67839195979906" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="11.760230418750002" x="0" y="461.30653266331666" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect><rect class="barR" width="3.4077406218750004" x="0" y="486.9346733668342" height="23.06532663316583" fill="#69d2cd" style="opacity: 0.9;"></rect></g><g id="r_Outlines" transform="translate(0,0)"><path id="outlineR" stroke=" #24a79b" fill="none" stroke-width="2px" d="M 17.59539560625 0 L 17.59539560625 0 L 17.59539560625 25.62814070351759L 26.564096165625003 25.62814070351759 L 26.564096165625003 51.25628140703518L 40.433297765625 51.25628140703518 L 40.433297765625 76.88442211055278L 52.391896368750004 76.88442211055278 L 52.391896368750004 102.51256281407036L 72.95419411875001 102.51256281407036 L 72.95419411875001 128.14070351758795L 72.750353540625 128.14070351758795 L 72.750353540625 153.76884422110555L 79.66011307500001 153.76884422110555 L 79.66011307500001 179.39698492462313L 93.339479896875 179.39698492462313 L 93.339479896875 205.02512562814073L 99.06807138750001 205.02512562814073 L 99.06807138750001 230.65326633165833L 93.62144039062501 230.65326633165833 L 93.62144039062501 256.2814070351759L 85.169911921875 256.2814070351759 L 85.169911921875 281.9095477386935L 93.59423325 281.9095477386935 L 93.59423325 307.5376884422111L 94.826976525 307.5376884422111 L 94.826976525 333.1658291457287L 93.21418513125 333.1658291457287 L 93.21418513125 358.79396984924625L 84.753808425 358.79396984924625 L 84.753808425 384.42211055276385L 75.02524821562501 384.42211055276385 L 75.02524821562501 410.05025125628146L 81.52183788750001 410.05025125628146 L 81.52183788750001 435.67839195979906L 85.89466257187502 435.67839195979906 L 85.89466257187502 461.30653266331666L 64.90173510000001 461.30653266331666 L 64.90173510000001 486.9346733668342L 14.934254315625003 486.9346733668342 L 14.934254315625003 510"></path></g></g><rect width="37.703125" height="22" x="46.671875" y="188.02513122558594" fill="#fff" opacity="0.8" transform="translate(0, 0) "></rect><text class="mfLabel annotext0" text-anchor="end" y="205.02512562814073" x="84.375" transform="translate(0, 0) "><tspan>Male</tspan></text><rect width="55.96875" height="22" x="140.625" y="188.02513122558594" fill="#fff" opacity="0.8" transform="translate(287.7358490566038, 0) "></rect><text class="mfLabel annotext1" text-anchor="start" y="205.02512562814073" x="140.62500000000003" transform="translate(287.7358490566038, 0) "><tspan>Female</tspan></text></svg></div>
<div class="footer">
<h6 id="source"><p>Source: Home Office Data Hub</p><p>Source: Home Office Data Hub</p></h6>
</div>

<script src="./d3.min.js.download" type="text/javascript"></script>
<script src="./modernizr.svg.min.js.download" type="text/javascript"></script>
<script src="./pym.min.js.download" type="text/javascript"></script>
<script>

    var graphic = d3.select('#graphic');
    var keypoints = d3.select('#keypoints');
    var footer = d3.select(".footer");
    var pymChild = null;

		function drawGraphic(width) {
		   var threshold_md = 550;
		   var threshold_sm = dvc.optional.mobileBreakpoint;

		  	//set variables for chart dimensions dependent on width of #graphic
		    if (parseInt(graphic.style("width")) < threshold_sm) {
          var size = 0;
		      var margin = {
            top: dvc.optional.margin_sm[0],
            right: dvc.optional.margin_sm[1],
            bottom: dvc.optional.margin_sm[2],
            left: dvc.optional.margin_sm[3]
          };
					var chart_width = parseInt(graphic.style("width")) - margin.left - margin.right;
		      var height = Math.ceil((chart_width * dvc.optional.aspectRatio_sm[1]) / dvc.optional.aspectRatio_sm[0]) - margin.top - margin.bottom;
		    } else if (parseInt(graphic.style("width")) < threshold_md){
          var size = 1;
		      var margin = {
            top: dvc.optional.margin_md[0],
            right: dvc.optional.margin_md[1],
            bottom: dvc.optional.margin_md[2],
            left: dvc.optional.margin_md[3]
          };
					var chart_width = parseInt(graphic.style("width")) - margin.left - margin.right;
		      var height = Math.ceil((chart_width * dvc.optional.aspectRatio_md[1]) / dvc.optional.aspectRatio_md[0]) - margin.top - margin.bottom;
		  	} else {
          var size = 2;
		      var margin = {top: dvc.optional.margin_lg[0], right: dvc.optional.margin_lg[1], bottom: dvc.optional.margin_lg[2], left: dvc.optional.margin_lg[3]}
					var chart_width = parseInt(graphic.style("width")) - margin.left - margin.right;
		      var height = Math.ceil((chart_width * dvc.optional.aspectRatio_lg[1]) / dvc.optional.aspectRatio_lg[0]) - margin.top - margin.bottom;
			}
//console.log(size)
			if (chart_width + margin.left + margin.right > 650) {
        maxWidth = 650;
        chart_width = maxWidth - margin.left - margin.right
      } else {
        maxWidth = chart_width + margin.left + margin.right
      }
console.log(chart_width)
      // clear out existing graphics
      graphic.selectAll("*").remove();
    footer.empty();


			 // parse data into columns
			var myMax = 0;
		    var bars = {};
		    for (var column in graphic_data[0]) {

            if (column == 'age') continue;
              if (column == 'index') continue;
		        bars[column] = graphic_data.map(function(d) {
              if(+d[column] > myMax){

                myMax = +d[column]
              };
		        });
		    }


			myMax = Math.ceil(myMax / dvc.essential.multiplier) * dvc.essential.multiplier

			var x = d3.scaleLinear()
				  .domain([0 , myMax])
		      .range([chart_width/2.8 , 0]);

			var x1 = d3.scaleLinear()
				.domain([0 , myMax])
				.range([ 0, chart_width/2.8]);

			var y = d3.scaleBand()
					  .domain(graphic_data.map(function(d) { return d.index; }))
					  .range( [0, height])
            .paddingInner(0.1);
            console.log(y.domain());

		    var yAxis = d3.axisLeft(y)

		    var x1Axis = d3.axisBottom(x1)
          .tickSize(-height, 0, 0)
          .ticks(dvc.optional.x_num_ticks_sm_md_lg[size]);

				var xAxis = d3.axisBottom(x)
          .tickSize(-height, 0, 0)
          .ticks(dvc.optional.x_num_ticks_sm_md_lg[size]);

		    //gridlines
        var x_axis_grid = function() { return xAxis; }

        var legend = d3.select('#graphic').append('svg')
        				.attr("width", chart_width + margin.left + margin.right)
        				.attr("height", height + margin.top + margin.bottom)
        				.append("g")
        				.attr("id", "legend");

          svg = d3.select('svg');

              createLegend();

			var halfWidth =  margin.left + chart_width/2.8 + dvc.essential.margin_centre[size]/2;
			 //create chart left
			var svgL = d3.select('svg').append('g')
			 			.attr("width", halfWidth )
				        .attr("height", height )  // + margin.top + margin.bottom
				        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

					svgL.append("rect")
						.attr("class","svgRect")
						.attr("width", chart_width/2.8)
						.attr("height", height);

				    svgL.append('g')
				        .attr('class', 'x axis')
				        .attr("transform", "translate(0, "+height+")")
				        .call(xAxis);
						//.append("text")
//						 .attr("y", 25)
//						 .attr("x",chart_width/dvc.essential.r_chart_placement_multiplier)
//						 .attr("dy", ".71em")
//						 .style("text-anchor", "start")
//						 .text(dvc.essential.xAxisLabel);

//				    svgL.append('g')
	//			        .attr('class', 'x grid')
		//		        .call(x_axis_grid()
			//	            .tickSize(height, 0, 0)
				//            .tickFormat('')
				  //      );

					//create y axis, if x axis doesn't start at 0 drop x axis accordingly
					//svgL.append('g')
//				        .attr('class', 'y axis')
//				        .attr('transform', function(d){
//				        			if(xDomain[0] != 0){
//										return 'translate(' + ( - 30) + ',0)'
//									} else {
//										return 'translate(' + 0  + ', 0)'
//									}
//							})
//				        .call(yAxis);


    //get to the first data value for series 1 and 2, needed for beginning outline drawing
		var value1=graphic_data[0].MaleLine;
		var value2=graphic_data[0].FemaleLine;


    //starting points for outlines to the histograms
	//	var pathData1="M "+ x(0)+" "+0+" L"+ x(value1)+" "+0+" ";
		//var pathData2="M "+x1(0)+" "+0+" L"+ x1(value2)+" "+0+" ";
    var pathData1="M "+ x(value1)+" "+0+" ";
		var pathData2="M "+ x1(value2)+" "+0+" ";


			svgL.append('g').attr("class","bars").selectAll('rect')
					.data(graphic_data) //  change this to variable
					.enter()
					.append('rect')
					.attr('class', 'barL')
					.attr("width", function(d) { return Math.abs(x(d[names[1]]) - x(0)); })  // 0 +
					.attr("x", function(d) {   return x(d[names[1]]); })
					.attr("y", function(d) {

            if(d.index-1 >=0){
              pathData1=pathData1+"L "+(x(d[names[3]]))+" "+y(d.index)+" L "+x(d[names[3]])+" "+y(d.index-1);
            } else {
              pathData1=pathData1+"L "+(x(d[names[3]]))+" "+y(d.index)+" L "+x(d[names[3]])+" "+height;
            }
            return y(d.index);
          })
					.attr("height", y.bandwidth())
          .attr("fill",dvc.essential.colour_palette[0])
          .style("opacity", 0.9);




		var svgR = d3.select('svg').append('g')
			 			.attr("width", (margin.left + (chart_width/dvc.essential.r_chart_placement_multiplier) + dvc.essential.margin_centre[size]/2 ) )
				        .attr("height", height )  // + margin.top  + margin.bottom
				        .attr("transform", "translate(" + ( margin.left + (chart_width/dvc.essential.r_chart_placement_multiplier) + dvc.essential.margin_centre[size] ) + "," + margin.top + ")");

					svgR.append("rect")
						.attr("class","svgRect")
						.attr("width", chart_width/dvc.essential.r_chart_placement_multiplier)
						.attr("height", height);

				    svgR.append('g')
				        .attr('class', 'x axis')
				        .attr("transform", "translate(0, "+height+")")
				        .call(x1Axis);
						//.append("text")
						// .attr("y", 25)
						// .attr("x",chart_width/3)
						// .attr("dy", ".71em")
						// .style("text-anchor", "start")
						// .text(dvc.essential.xAxisLabel);  // no label

            //finish the path data for series 1
    				//pathData1=pathData1;//+"L "+x(0)+" "+height;

            svgL.append('g')
      					.attr("id","l_Outlines")
      					.attr("transform", "translate(0,0)")
      					.append("path")
      						.attr("id","outlineL")
                  .attr("stroke",dvc.essential.colour_palette[2])
      						.attr("fill","none")
      						.attr("stroke-width","2px")
      						.attr("d",pathData1);

					//create y axis, if x axis doesn't start at 0 drop x axis accordingly
					svgR.append('g')
				        .attr('class', 'y axis')
				        .attr('transform', function(d){
				        			//if(this.getBBox() ??? ){
										return 'translate(' + ( - (dvc.essential.margin_centre[size]/3)-2 ) + ',0)'
									//} else {
										//return 'translate(' + 0  + ', 0)'
									//}
							})
				        .call(yAxis);

						d3.select('g.y.axis').select('.domain').remove();					// removes y line
						d3.select('g.y.axis').selectAll('.tick').select('line').remove();	// removes inner ticks
						d3.select('g.y.axis').selectAll('.tick').select('text').style('text-anchor', 'middle');
            d3.select('g.y.axis').selectAll('.tick').style("font-size", "14px")
            .select('text')
            .style("fill", "#666")
              .each(function(d,i){
                if(i % dvc.optional.y_ticks_sm_md_lg_every_other[size]){
                  d3.select(this).attr("fill", "none")
                }
              })

			svgR.append('g').attr("class","bars").selectAll('rect')
					.data(graphic_data) //  change this to variable
					.enter()
					.append('rect')
					.attr('class', 'barR')
					.attr("width", function(d) { return 0 + Math.abs(x1(d[names[2]]) - x1(0)); })
					.attr("x", function(d) {  return x1(0); })
												//return x1(d.amt); })
					.attr("y", function(d) {
            if(d.index-1 >=0){

              pathData2=pathData2+"L "+(x1(d[names[4]]))+" "+y(d.index)+" L "+x1(d[names[4]])+" "+y(d.index-1);
          //    console.log("L "+((d[names[4]]))+" "+(d.index)+" L "+(d[names[4]])+" "+(d.index-1))
            } else {
              pathData2=pathData2+"L "+(x1(d[names[4]]))+" "+y(d.index)+" L "+x1(d[names[4]])+" "+height
            }
            return y(d.index);
          })
					.attr("height", y.bandwidth())
          .attr("fill",dvc.essential.colour_palette[1])
          .style("opacity", 0.9);

          //finish the path data for series 2
          //pathData2=pathData2;+"L "+x1(0)+" "+height;

          svgR.append('g')
              .attr("id","r_Outlines")
              .attr("transform", "translate(0,0)")
              .append("path")
              .attr("id","outlineR")
              .attr("stroke",dvc.essential.colour_palette[3])
              .attr("fill","none")
              .attr("stroke-width","2px")
              .attr("d",pathData2);

d3.select(".y").selectAll(".tick").each(function(d,i){
  //console.log(d3.select(this).select("text").text(),+"  "+i)
  label=graphic_data[i].age
//  console.log(label)
  d3.select(this).select("text").text(label)
});


	function createLegend(){

							prevX= 0;
							prevY= 0;
							lineNo = 0;
							lineNoOld = 0;

				dvc.essential.legendLabels.forEach(function(d,i) {

							// draw legend text based on content of var legendLabels ...
				var_group= d3.select("#legend").append("g")

				var_group.append("rect")
								.attr("class","rect" + i)
								.attr("fill", dvc.essential.colour_palette[i])
								.attr("x", 0)
								.attr("y", 0)
								.attr("width", function(d,i){
									if(dvc.essential.legendStyle[i]=="rect"){
										return 15;
									} else {
										return 20;
									}
								})
								.attr("height", function(d){
									if(dvc.essential.legendStyle[i]=="rect"){
										return 15;
									} else {
										return 3;
									}
								})

							var_group.append("text")
								.text(dvc.essential.legendLabels[i])
								.attr("class","legend" + i)
								.attr("text-anchor", "start")
								.style("font-size", "14px")
								.style("fill", "#666")
								.attr('y',15)
								.attr('x',0);



							d3.selectAll(".legend" + (i))
								.each(calcPosition);



							function calcPosition() {


							var BBox = this.getBBox()



								d3.select(".legend" + (i))
										.attr("y",function(d){
										if((prevX+BBox.width + 50) > //parseInt(graphic.style("width"))
                    (chart_width + margin.left + margin.right)
                   ){
														lineNoOld = lineNo;
														lineNo=lineNo + 1;
														prevX = 0;
													}
												return eval((lineNo*20) + 20);
										})
										.attr("x",function(d){ return prevX+25;})


								d3.select(".rect" + (i))
										.attr("y",function(d){

												if((prevX+BBox.width +50)>parseInt(graphic.style("width")) ){
													lineNoOld = lineNo;
													lineNo=lineNo + 1;
													prevX = 0;
												}

												if(dvc.essential.legendStyle[i]=="rect"){
													return eval((lineNo*20)+5);
												} else {
													return eval((lineNo*20)+12);

												}
										})
										.attr("x",function(d){ return prevX; })

								prevX = prevX + BBox.width +50



								//d3.select("#chart").attr("transform", "translate(" + margin.left + "," +( margin.top + eval((lineNo+1)*margin.top))+ ")")

							}; // end function calcPosition()
						});	// end foreach
			}// end function createLegend()




  writeAnnotation();

	function writeAnnotation(){

		if (parseInt(graphic.style("width")) < threshold_sm) {

				dvc.essential.annotationBullet.forEach(function(d,i) {

					d3.select("#keypoints").append("svg")
						.attr("width","20px")
						.attr("height","20px")
						.attr("class","circles")
						.append("circle")
						.attr("class", "annocirc" + (i))
						.attr("r", "2")
						.attr('cy',"12px")
						.attr("cx", "10px");

					d3.select("#keypoints").append("p").text(dvc.essential.annotationBullet[i]);

				})// end foreach
		}
		else {

				dvc.essential.annotationChart.forEach(function(d,i) {

					// draw annotation text based on content of var annotationArray ...

					svg.append("text")
						.text(dvc.essential.annotationChart[i])
						.attr("class","mfLabel annotext" + i)
						.attr("text-anchor", dvc.essential.annotationAlign[i])
            .attr('y',y(dvc.essential.annotationXY[i][1]))
						.attr('x', function(){  if(i == 0) { 	return x(dvc.essential.annotationXY[i][0] );  }
														else {	return x1(dvc.essential.annotationXY[i][0] );  }
														  })
            // .attr("transform", function(){ if(i == 0) { return "translate(0, 0) ";	}
						// 							else { return "translate(" + ( margin.left + (chart_width/2.4) + dvc.essential.margin_centre[size] ) + ", 0) "; }
						// 							});
						.attr("transform", function(){
            //  if(i == 0 || i== 2)
              if(i == 0) {
                return "translate(0, 0) ";
              }	else {
                return "translate(" + ( margin.left + (chart_width/dvc.essential.r_chart_placement_multiplier) + dvc.essential.margin_centre[size] ) + ", 0) ";
              }
				});

					d3.selectAll(".annotext" + (i))
						.each(insertLinebreaks)
						.each(createBackRect);


					function insertLinebreaks() {

						var str = this;

						var el1 = dvc.essential.annotationChart[i];
						var el = el1.data;

						var words = el1.split('  ');

						d3.select(this/*str*/).text('');

						for (var j = 0; j < words.length; j++) {
							var tspan = d3.select(this).append('tspan').text(words[j]);
							if (j > 0)
								tspan.attr('x', x(dvc.essential.annotationXY[i][0])).attr('dy', '22');
						}
					};

					function createBackRect() {

					var BBox = this.getBBox()
							svg.insert("rect", ".annotext" + (i))
								.attr("width", BBox.width)
								.attr("height", BBox.height)
								.attr("x", BBox.x)
								.attr("y", BBox.y)
                .attr('fill', '#fff')
								.attr("opacity", 0.8)
								.attr("transform", function(){ if(i == 0) { return "translate(0, 0) ";	}
													else { return "translate(" + ( margin.left + (chart_width/dvc.essential.r_chart_placement_multiplier) + dvc.essential.margin_centre[size] ) + ", 0) "; }
													});;

					}; // end function createBackRect()

				});	// end foreach

		} // end else ...

		// If you have labels rather than years then you can split the lines using a double space (in the CSV file).


		function insertLinebreaksLabels() {
						var str = this.textContent;

						var words = str.split('  ');

						d3.select(this/*str*/).text('');

						for (var j = 0; j < words.length; j++) {
							var tspan = d3.select(this).append('tspan').text(words[j]);
							if (j > 0)
								tspan
								.attr('x', -10)
								.attr('dy', '1em');
								}
		};

		d3.selectAll(".y text").each(insertLinebreaksLabels)


	}// end function writeAnnotation()

			//create link to source
			d3.select("#source").append("p")
				.text("Source: " + dvc.essential.sourceText)
				// .attr("target", "_blank")
				// .html(dvc.essential.sourceText);

			//use pym to calculate chart dimensions
		    if (pymChild) {
		        pymChild.sendHeight();
		    }
		}

	//check whether browser can cope with svg
	if (Modernizr.svg) {
		   //load config
			d3.json("config.json", function(error, config) {
			dvc=config

				//load chart data
				d3.csv(dvc.essential.graphic_data_url, function(error, data) {
					graphic_data = data;

          names = d3.keys(/*data*/graphic_data[0])
                    .filter(function(key) {
                        return key !== "age";
                        return key !== "index";
                    });

          graphic_data.forEach(function(d) {
            d.ages = names.map(function(name) {
              return {
                name: name,
                value: +d[name]
              };
            });
          });

						//use pym to create iframed chart dependent on specified variables
						pymChild = new pym.Child({ renderCallback: drawGraphic});

					}); // ends csv

			}) // ends config

		} else {
			 //use pym to create iframe containing fallback image (which is set as default)
			 pymChild = new pym.Child();
			if (pymChild) {
		        pymChild.sendHeight();
		    }
		}
    </script>


</body></html>
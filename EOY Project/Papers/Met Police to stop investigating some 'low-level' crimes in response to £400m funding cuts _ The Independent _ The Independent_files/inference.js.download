!function(){function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&a(e,n)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,n){return(a=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e,n,t){return(s=u()?Reflect.construct:function(e,n,t){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(e,r));return t&&a(i,t.prototype),i}).apply(null,arguments)}function c(e){var n="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return s(e,arguments,o(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,e)})(e)}function f(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function l(e){var n=u();return function(){var t,r=o(e);if(n){var i=o(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return f(this,t)}}function d(e,n,t){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,t){var r=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=o(e)););return e}(e,n);if(r){var i=Object.getOwnPropertyDescriptor(r,n);return i.get?i.get.call(t):i.value}})(e,n,t||e)}function h(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return t}(e,n)||m(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,n){if(e){if("string"==typeof e)return v(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?v(e,n):void 0}}function v(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var g=function(n){i(r,n);var t=l(r);function r(){return e(this,r),t.apply(this,arguments)}return r}(c(Error)),y=function(n){i(r,n);var t=l(r);function r(){return e(this,r),t.apply(this,arguments)}return r}(c(Error)),w=function(n){i(r,n);var t=l(r);function r(){return e(this,r),t.apply(this,arguments)}return r}(c(Error)),b=function(n){i(r,n);var t=l(r);function r(){return e(this,r),t.apply(this,arguments)}return r}(w),_=function(n){i(r,n);var t=l(r);function r(){return e(this,r),t.apply(this,arguments)}return r}(w),S=function(n){i(r,n);var t=l(r);function r(){return e(this,r),t.apply(this,arguments)}return r}(_);function j(e){if(!Array.isArray(e))throw new y("Provided argument must be an instance of Array.")}function A(e){return!!Array.isArray(e)&&e.every((function(e){return"number"==typeof e}))}function O(e,n,t){var r,i,o,a=null===(i=null===(r=null==t?void 0:t.decision_thresholds)||void 0===r?void 0:r[e])||void 0===i?void 0:i[n.modelId];if(void 0!==a)return a;if(void 0!==(a=null===(o=null==t?void 0:t.performance_targets)||void 0===o?void 0:o[e]))return a;throw new _("Could not determine the decision threshold for target ".concat(e,": the TargetingProfileConfig contains neither a precision target or decision threshold!"))}function k(e){return 1/(1+Math.exp(-e))}var C=function(){function n(t){e(this,n),this.feature=t}return t(n,[{key:"transform",value:function(e){if(!(this.feature in e))throw new S("Unable to transform feature ".concat(this.feature,", missing input ").concat(this.feature,". \n                    Provided: ").concat(Object.keys(e),", Required: ").concat(this.dependencies));return e[this.feature]}},{key:"dependencies",get:function(){return[this.feature]}}]),n}(),P=function(n){i(o,n);var r=l(o);function o(n,t){var i;return e(this,o),(i=r.call(this,n)).interactions=t,i}return t(o,[{key:"transform",value:function(e){for(var n=this,t=this.interactions.map((function(t){if(!(t in e))throw new S("Unable to transform feature ".concat(n.feature,", missing input ").concat(t,".\n                    Provided: ").concat(Object.keys(e),", Required: ").concat(n.dependencies));return e[t]})).sort((function(e,n){return n.length-e.length})),r=0;r<t.length-1;r++){if(1!==t[r].length&&t[r].length!==t[r+1].length&&1!==t[r+1].length)throw new S("Unable to perform MultiplicativeInteraction: shapes can not be broadcasted.");if(!A(t[r]))throw new S("Unable to perform MultiplicativeInteraction: not all inputs are of type number[]")}for(var i=p(t[0]),o=1;o<t.length;o++)for(var a=0;a<i.length;a++)t[o].length>1?i[a]=i[a]*t[o][a]:i[a]=i[a]*t[o][0];return i}},{key:"dependencies",get:function(){return this.interactions}}]),o}(C),E=function(n){i(o,n);var r=l(o);function o(n,t,i){var a;return e(this,o),(a=r.call(this,n)).input=t,a.value=i,a}return t(o,[{key:"transform",value:function(e){if(!(this.input in e))throw new S("Unable to transform feature '".concat(this.feature,"'. Missing required input '").concat(this.input,"'."));var n=e[this.input];if(n.length!==this.value.length)return[0];for(var t=0;t<n.length;t++)if(n[t]!==this.value[t])return[0];return[1]}},{key:"dependencies",get:function(){return[this.input]}}]),o}(C),R=function(n){i(o,n);var r=l(o);function o(n,t,i,a){var u;return e(this,o),(u=r.call(this,n)).input=t,u.min=i,u.max=a,u}return t(o,[{key:"transform",value:function(e){if(!(this.input in e))throw new S("Unable to transform feature '".concat(this.feature,"'. Missing required input '").concat(this.input,"'."));for(var n=p(e[this.input]),t=0;t<n.length;t++)this.min&&n[t]<this.min?n[t]=this.min:this.max&&n[t]>this.max&&(n[t]=this.max);return n}},{key:"dependencies",get:function(){return[this.input]}}]),o}(C),I=function(n){i(o,n);var r=l(o);function o(n,t,i,a){var u;return e(this,o),(u=r.call(this,n)).input=t,u.min=i,u.scale=a,u}return t(o,[{key:"transform",value:function(e){if(!(this.input in e))throw new S("Unable to transform feature '".concat(this.feature,"'. Missing required input '").concat(this.input,"'."));var n=e[this.input];if(n.length!==this.min.length||n.length!==this.scale.length)throw new S("Unable to transform feature '".concat(this.feature,"'. Shapes do not match."));if(!A(n))throw new S("Unable to transform feature '".concat(this.feature,"'. The input must be an array of numbers."));for(var t=new Array(n.length),r=0;r<n.length;r++)t[r]=this.scale[r]*n[r]+this.min[r];return t}},{key:"dependencies",get:function(){return[this.input]}}]),o}(C);function T(e){return"type"in e&&"string"==typeof e.type}function x(e){if(!e.transformation)return new C(e.name);if(T(n=e.transformation)&&"multiplication"===n.type)return new P(e.name,e.transformation.features);var n;if(function(e){return T(e)&&"equality"===e.type}(e.transformation))return new E(e.name,e.transformation.input,e.transformation.value);if(function(e){return T(e)&&"clipping"===e.type}(e.transformation))return new R(e.name,e.transformation.input,e.transformation.min,e.transformation.max);if(function(e){return T(e)&&"minmax_scaling"==e.type}(e.transformation))return new I(e.name,e.transformation.input,e.transformation.min,e.transformation.scale);throw new b("Selected transformation (".concat(e.transformation.type,") is not supported."))}var q=function(){function n(t,r,i){e(this,n),this.name=t,this.transformer=r,this.index=i}return t(n,[{key:"dependencies",get:function(){return this.transformer.dependencies}}]),n}();function M(e){var n=e.features;return j(n),n.map((function(n,t){return e.model.features&&(t=e.model.features.indexOf(n.name)),new q(n.name,x(n),t)}))}var F=function(){function n(t,r){e(this,n),this.features=r,this.measurements=t}return t(n,[{key:"_getFeatureValue",value:function(e,n,t){var r=this;if(e.name in t)return t[e.name];if(1===e.dependencies.length&&e.dependencies[0]===e.name){var i=this.measurements.get(e.name,n);return t[e.name]=[i],t[e.name]=e.transformer.transform(t),t[e.name]}return e.dependencies.forEach((function(i){var o=r.features.find((function(e){return e.name===i}));if(!o)throw new _("Feature '".concat(e.name,"' is dependent on ").concat(i,", but this feature has not been defined!"));if(o.transformer.dependencies.includes(e.name))throw new _("IllegalDependency: Feature '".concat(e.name,"' is dependent on ").concat(i,"', but '").concat(i," is also dependent on '").concat(e.name,"'!"));r._getFeatureValue(o,n,t)})),t[e.name]=e.transformer.transform(t),t[e.name]}},{key:"get",value:function(e){var n=this,t={},r={};return this.features.forEach((function(i){-1!==i.index&&(t[i.name]=n._getFeatureValue(i,e,r))})),t}}]),n}(),U=Object.freeze({LOGISTIC_REGRESSION:"logistic_regression",PASSTHROUGH:"passthrough"});function D(e){if(!e.model_id)throw new b("Could not load model: missing required value model_id");if(!e.definition)throw new b("Could not load model: missing required definition");var n,t,r,i,o,a=JSON.parse(e.definition);if(!a.model)throw new b("Could not load model: missing required field 'model' in the model definition.");if(!a.features)throw new b("Could not load model: missing required feature definitions.");return a.model.type===U.PASSTHROUGH?(t=a,r=e.model_id,o=M(t),n=new N(r,o,null!==(i=t.version)&&void 0!==i?i:"")):n=function(e,n){var t;if(e.model.type!==U.LOGISTIC_REGRESSION)throw new b("Could not load model with unsupported type: ".concat(e.model.type));var r=M(e),i=function(e){if(!function(e){var n=e;return"logistic_regression"===(null==n?void 0:n.type)&&A(null==n?void 0:n.weights)&&"number"==typeof(null==n?void 0:n.bias)}(e))throw new b("Received invalid model configuration: the provided config is not a LogisticRegressionConfig");return new L(e.weights,e.bias)}(e.model);return new G(n,r,i,null!==(t=e.version)&&void 0!==t?t:"")}(a,e.model_id),!n.version&&e.version&&(n.version=e.version),n}var L=function(){function n(t,r){if(e(this,n),!A(t))throw new w("Weights must be provided as an Array.");this.weights=t,this.bias=r}return t(n,[{key:"predict",value:function(e){if(!(e instanceof Array))throw new _("FeatureProcessor must be provided as an Array.");var n=function(e){if("number"==typeof e)return k(e);j(e);for(var n=[],t=0;t<e.length;t++)n.push(k(e[t]));return n}(function(e,n){if(j(e),j(n),e.length!==n.length)throw new g("Vectors must have equal length (".concat(e.length," != ").concat(n.length,")"));for(var t=0,r=0;r<e.length;r++)t+=e[r]*n[r];return t}(e,this.weights)+this.bias);return[1-n,n]}}]),n}(),V=function(){function n(t,r,i){e(this,n),j(r),this.featureColumns=r,this.modelId=t,this.version=i}return t(n,[{key:"getFeatures",value:function(e,n){return new F(e,this.featureColumns).get(n)}}]),n}(),G=function(n){i(o,n);var r=l(o);function o(n,t,i,a){var u;if(e(this,o),u=r.call(this,n,t,a),!(i instanceof L))throw new w("logisticRegression must be an instanceof LogisticRegression");return u.logisticRegression=i,u}return t(o,[{key:"predict",value:function(e){var n=[];return this.featureColumns.reduce((function(e,n){return-1!==n.index&&e.push(n),e}),[]).sort((function(e,n){return e.index-n.index})).forEach((function(t){if(!(t.name in e))throw new _("Missing required feature: ".concat(t.name));n=n.concat(e[t.name])})),this.logisticRegression.predict(n)[1]}}]),o}(V),N=function(n){i(u,n);var a=l(u);function u(n,t,r){return e(this,u),a.call(this,n,t,r)}return t(u,[{key:"getFeatures",value:function(e,n){var t;try{t=d(o(u.prototype),"getFeatures",this).call(this,e,n)}catch(e){t=r({},this.passthroughFeatureColumn.name,[-1])}return t}},{key:"predict",value:function(e){var n=this.passthroughFeatureColumn;return n.name in e||(e[n.name]=[-1]),e[n.name][0]}},{key:"passthroughFeatureColumn",get:function(){if(void 0!==this._passthroughFeatureColumn)return this._passthroughFeatureColumn;var e=this.featureColumns.reduce((function(e,n){return-1!==n.index&&e.push(n),e}),[]).sort((function(e,n){return e.index-n.index}));if(e.length<1)throw new _("Could not determine passthrough feature column: model definition is invalid");if(e.length>1)throw new _("Could not determine passthrough feature column: multiple columns were provided");return this._passthroughFeatureColumn=e[0],this._passthroughFeatureColumn}}]),u}(V),H=function(){function n(t){var r=this;e(this,n),this.playSessionSequence=0,this.advanceType="unknown",t.on("playlistItem",(function(){r.playSessionSequence||(r.playSessionSequence=0),r.playSessionSequence++})),t.on("nextAutoAdvance",(function(){r.advanceType="auto"})),t.on("feedAutoAdvance",(function(){r.advanceType="auto"})),t.on("nextClick",(function(){r.advanceType="click"})),t.on("feedClick",(function(){r.advanceType="click"}))}return t(n,[{key:"getPlaySessionSequence",value:function(){return this.playSessionSequence||0}},{key:"getAdvanceType",value:function(){return this.advanceType}}]),n}(),z={viewable:2},Y=function(){function n(t,r,i){e(this,n),this.PLAYER_MEASUREMENT_MAP={is_player_viewable_at_inference_time:t.getViewable,is_player_viewable:t.getViewable,is_player_muted:t.getMute,play_session_sequence:r.getPlaySessionSequence,autostart:function(){var e=t.getConfig();return e.autostart&&e.autostart in z?z[e.autostart]:e.autostart?1:0},advance_type:r.getAdvanceType},this.metrics=i}return t(n,[{key:"get",value:function(e,n){if(e in this.PLAYER_MEASUREMENT_MAP)return this.PLAYER_MEASUREMENT_MAP[e]();var t=n&&"mediaid"in n?n.mediaid:null;if(t&&t in this.metrics.media&&e in this.metrics.media[t])return this.metrics.media[t][e];if(this.metrics.domain&&e in this.metrics.domain)return this.metrics.domain[e];if(this.metrics.defaults&&e in this.metrics.defaults)return this.metrics.defaults[e];throw new _("Unsupported measurement: ".concat(e))}}]),n}(),J=function n(t){var r,i,o,a,u,s,c=this;e(this,n),this.domain={},this.media={},this.defaults={},(null===(i=null===(r=null==t?void 0:t.jwpseg)||void 0===r?void 0:r.metrics)||void 0===i?void 0:i.domain)&&(this.domain=null==t?void 0:t.jwpseg.metrics.domain),(null===(a=null===(o=null==t?void 0:t.jwpseg)||void 0===o?void 0:o.metrics)||void 0===a?void 0:a.defaults)&&(this.defaults=null==t?void 0:t.jwpseg.metrics.defaults),(null===(s=null===(u=null==t?void 0:t.jwpseg)||void 0===u?void 0:u.metrics)||void 0===s?void 0:s.media)&&Object.keys(null==t?void 0:t.jwpseg.metrics.media).forEach((function(e){var n,r,i,o;c.media[e]=null!==(o=null===(i=null===(r=null===(n=null==t?void 0:t.jwpseg)||void 0===n?void 0:n.metrics)||void 0===r?void 0:r.media)||void 0===i?void 0:i[e])&&void 0!==o?o:{}}))};(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)("inference","7.0",(function(e,n,t){var i,o,a,u,s=!1,c=new H(e);function f(){var n,t;if(!s){if(!i||!o){if(!(o=e.getPlaylist())||"string"==typeof o)return void(s=!1);var r=e.getPlaylistItem();if(!r||!r.feedData)return;i=null!==(n=r.feedData)&&void 0!==n?n:{}}if(null===(t=null==i?void 0:i.jwpseg)||void 0===t?void 0:t.parameters){try{a=Object.entries(i.jwpseg.parameters).reduce((function(e,n){var t,r=h(n,2),i=r[0],o=r[1];return e[i]=(t=o,Array.isArray(t)?t.map(D):[D(t)]),e}),{})}catch(e){return console.warn("Failed to initialize the inference plugin: ".concat(e)),void l()}u=new Y(e,c,new J(i)),s=!0}else l()}}function l(){i=null,o=null,a=null,u=null,s=!1}function d(e,n,t){var r={processed:e.join(",")};return n&&n.jwpseg&&Array.isArray(n.jwpseg)&&(r.historicalApproved=n.jwpseg.join(",")),t&&(r.realTimeApproved=Object.keys(t).filter((function(e){return t[e]})).join(",")),r}return e.on("playlist",(function(e){l(),i=e.feedData,o=e.playlist,f()})),f(),{predict:function(n,t){var o;if(!s||!u)throw new _("The InferencePlugin has not been initialized.");var c=null===(o=null==i?void 0:i.jwpseg)||void 0===o?void 0:o.target_profiles;if(!c)throw new _("Feed did not contain targeting profiles!");var f={},l={},h={};return n.forEach((function(n){var i,o=null==c?void 0:c[n];if(!o)throw new _("The performance target requirements for TPI ".concat(n," are missing!"));if(!(o=function(e){return void 0!==e.performance_targets?e:{performance_targets:e,decision_thresholds:{}}}(o)).performance_targets)throw new _("The TPI ".concat(n," does not have any performance_targets defined!"));var s=Object.keys(null!==(i=o.performance_targets)&&void 0!==i?i:{}),d={};l[n]=s.every((function(n){if(n in f){var i=O(n,f[n],o);return d[n]=r({},f[n].modelId,i),f[n].prediction>i}var s=function(n){var t,r,i,o=e.getConfig().__ab_inference;if(null===(t=null==o?void 0:o.modelMap)||void 0===t?void 0:t[n]){var u=o.modelMap[n];i=null==a?void 0:a[n].find((function(e){return e.modelId===u}))}else{var s=null!==(r=null==a?void 0:a[n])&&void 0!==r?r:[],c=s.map((function(e){return e.modelId}));c.sort((function(e,n){return e.localeCompare(n)})),i=s.find((function(e){return e.modelId===c[0]}))}if(!i)throw new _("Could not make predictions for target '".concat(n,"': no model available to support the request."));return i}(n),c=s.getFeatures(u,t);f[n]={modelVersion:s.version,prediction:s.predict(c),modelId:s.modelId};var l=O(n,f[n],o);return d[n]=r({},f[n].modelId,l),f[n].prediction>l})),h[n]=d})),e.trigger("inference",{predictions:f,playlistItem:t,segments:d(n,t,l),decisionThresholds:h}),l},version:"0.7.1"}}))}();

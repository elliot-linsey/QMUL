<!DOCTYPE html>
<!-- saved from url=(0459)https://www.ons.gov.uk/visualisations/dvc1080/fig3/index.html?initialWidth=700&childId=6ac-4a2d-895e-0a7e236b938e&parentTitle=The%20impact%20of%20the%20coronavirus%20so%20far%3A%20the%20industries%20that%20struggled%20or%20recovered%20-%20Office%20for%20National%20Statistics&parentUrl=https%3A%2F%2Fwww.ons.gov.uk%2Feconomy%2Feconomicoutputandproductivity%2Foutput%2Farticles%2Ftheimpactofthecoronavirussofartheindustriesthatstruggledorrecovered%2F2020-12-09 -->
<html lang="en" class="embedded"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="./css(1)" rel="stylesheet" type="text/css">
<title>COVID Impact on Industry</title>
<meta name="description" content="">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="./globalStyle.css">
<style type="text/css">
    body {
      color: #323132;
      /* max-width:944px; */
    }

    .x.axis path {
      display: none;
    }

    path {
      fill: none;
    }

    text {
      font-family: 'Open Sans'
    }

    text.x,
    text.y {
      font-size: 12px;
      fill: #666;
    }

    line.y,
    line.x {
      stroke: #ccc;
      stroke-width: 1px;
      shape-rendering: crispEdges;
    }

    #legend {
      font-size: 12px;
      min-height: 30px;
    }

    h4 {
      font-size: 16px;
      line-height: 24px;
      margin: 16px 0 16px 0;
      padding: 24px 0 0 0;
      font-weight: bold;
    }

    h5 {
      font-size: 14px;
      margin: 0 0 16px 0;
      font-weight: normal;
      padding-top: 0;
    }

    h5,h6 {
      font-size: 16px;
      margin: 16px 0 8px 0;
      font-weight: 700;
      color: #323132;
    }

    ul, ol {
      margin: 16px 0;
      padding-left: 32px;
    }

    li {
        margin: 0 0 8px 0;
        line-height: 32px;
        font-weight: 400;
        font-size: 18px;
        padding: 0;
    }

    @media (max-width:767px){
        li{
          font-size:16px;
        }
    }

  	.linelbwregion {
  		stroke: #206095;
  		stroke-linecap: round !important;
  		stroke-width: 2px !important;
  	}

    .linelbwew {
  		stroke: #118C7B;
      /*stroke-dasharray: 5 8 !important;*/
  		stroke-linecap: round !important;
  		stroke-width: 2px !important;
  	}
    .linebaseline {
  		stroke: #808080;
      /*stroke-dasharray: 5 8 !important;*/
  		stroke-linecap: round !important;
  		stroke-width: 1px !important;
  	}


    a {
        text-decoration: underline;
        font-size: 18px;
        font-weight: 400;
        line-height: 32px;
    }

    .btn {
        font-family: "Open Sans",Helvetica,Arial,sans-serif;
        display: inline-block;
        width: auto;
        cursor: pointer;
        padding: 6px 16px 10px 16px;
        border: 0 none;
        text-align: center;
        -webkit-appearance: none;
        transition: background-color 0.25s ease-out;
    }

    .btn--primary:focus {
    background-color: #0b5d30;
}

    .btn--primary {
    background-color: #0F8243;
    color: #fff;
}
.visuallyhidden{
  position: absolute;
  width: 1px;
  height: 1px;
  margin: -1px;
  padding: 0;
  overflow: hidden;
  clip: rect(0,0,0,0);
  border: 0;
}

  </style>
</head>
<body marginheight="0">
<h5 class="visuallyhidden">Non-specialised food stores and dispensing chemists experienced growth in sales volumes in March, with sales remaining above February levels ever since </h5>
<div id="legend" aria-hidden="true"><svg height="30" width="700"><g transform="translate(5,5)"></g></svg></div>
<div id="graphic" aria-hidden="true" style="position:relative">

<svg width="233.33333333333334" height="177" transform="translate(0,0)"><text x="35" y="12" font-weight="700" font-size="14px"><tspan x="35" y="12" dy="0em">Dispensing Chemists</tspan></text><g transform="translate(35,32)"><g class="x axis" transform="translate(0,110)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,6V0.5H175.83333333333334V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Feb 20</text></g><g class="tick" opacity="1" transform="translate(43.76953638598297,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Apr 20</text></g><g class="tick" opacity="1" transform="translate(87.79080203509976,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Jun 20</text></g><g class="tick" opacity="1" transform="translate(131.81206768421654,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Aug 20</text></g><g class="tick" opacity="1" transform="translate(175.83333333333334,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Oct 20</text></g></g><g class="y axis" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M175.33333333333334,110.5H0.5V0.5H175.33333333333334"></path><g class="tick" opacity="1" transform="translate(0,110.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">0</text></g><g class="tick" opacity="1" transform="translate(0,83)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">50</text></g><g class="tick" opacity="1" transform="translate(0,55.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">100</text></g><g class="tick" opacity="1" transform="translate(0,28)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">150</text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">200</text></g></g><path d="M0,55L20.92814268564569,55L43.26953638598297,55L64.91933916423713,55L87.29080203509976,55L108.94060481335391,55L131.31206768421654,55L153.6835305550792,55L175.33333333333334,55" class="linebaseline" stroke="#666" stroke-width="3px"></path><path d="M0,55L20.92814268564569,33.73046875L43.26953638598297,42.216796875L64.91933916423713,36.68457028499999L87.29080203509976,3.974609375L108.94060481335391,30.9375L131.31206768421654,30.776367159999992L153.6835305550792,27.71484375L175.33333333333334,16.865234375" class="linelbwregion" stroke="#666" stroke-width="3px"></path></g></svg><svg width="233.33333333333334" height="177" transform="translate(0,0)"><text x="35" y="12" font-weight="700" font-size="14px"><tspan x="35" y="12" dy="0em">Non-specialised Food</tspan><tspan x="35" y="12" dy="1.1em">Stores</tspan></text><g transform="translate(35,32)"><g class="x axis" transform="translate(0,110)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,6V0.5H175.83333333333334V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Feb 20</text></g><g class="tick" opacity="1" transform="translate(43.76953638598297,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Apr 20</text></g><g class="tick" opacity="1" transform="translate(87.79080203509976,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Jun 20</text></g><g class="tick" opacity="1" transform="translate(131.81206768421654,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Aug 20</text></g><g class="tick" opacity="1" transform="translate(175.83333333333334,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Oct 20</text></g></g><g class="y axis" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M175.33333333333334,110.5H0.5V0.5H175.33333333333334"></path><g class="tick" opacity="1" transform="translate(0,110.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,83)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,55.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,28)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g></g><path d="M0,55L20.92814268564569,55L43.26953638598297,55L64.91933916423713,55L87.29080203509976,55L108.94060481335391,55L131.31206768421654,55L153.6835305550792,55L175.33333333333334,55" class="linebaseline" stroke="#666" stroke-width="3px"></path><path d="M0,55L20.92814268564569,49.385530205L43.26953638598297,50.74826559L64.91933916423713,50.530227935L87.29080203509976,50.58473739L108.94060481335391,52.98315165L131.31206768421654,52.76511399500001L153.6835305550792,52.54707633999999L175.33333333333334,52.76511399500001" class="linelbwregion" stroke="#666" stroke-width="3px"></path></g></svg><svg width="233.33333333333334" height="177" transform="translate(0,0)"><text x="35" y="12" font-weight="700" font-size="14px"><tspan x="35" y="12" dy="0em">Hardware, Paints and</tspan><tspan x="35" y="12" dy="1.1em">Glass</tspan></text><g transform="translate(35,32)"><g class="x axis" transform="translate(0,110)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,6V0.5H175.83333333333334V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Feb 20</text></g><g class="tick" opacity="1" transform="translate(43.76953638598297,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Apr 20</text></g><g class="tick" opacity="1" transform="translate(87.79080203509976,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Jun 20</text></g><g class="tick" opacity="1" transform="translate(131.81206768421654,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Aug 20</text></g><g class="tick" opacity="1" transform="translate(175.83333333333334,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Oct 20</text></g><text transform="translate(175.33333333333334,29)" text-anchor="middle" fill="#666">Year</text></g><g class="y axis" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M175.33333333333334,110.5H0.5V0.5H175.33333333333334"></path><g class="tick" opacity="1" transform="translate(0,110.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,83)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,55.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,28)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g></g><path d="M0,55L20.92814268564569,55L43.26953638598297,55L64.91933916423713,55L87.29080203509976,55L108.94060481335391,55L131.31206768421654,55L153.6835305550792,55L175.33333333333334,55" class="linebaseline" stroke="#666" stroke-width="3px"></path><path d="M0,55L20.92814268564569,55L43.26953638598297,74.038461541L64.91933916423713,52.943376089999994L87.29080203509976,48.47756408000001L108.94060481335391,47.8311966L131.31206768421654,46.00961541L153.6835305550792,45.010683740000005L175.33333333333334,46.12713677" class="linelbwregion" stroke="#666" stroke-width="3px"></path></g></svg><svg width="233.33333333333334" height="177" transform="translate(0,0)"><text x="35" y="12" font-weight="700" font-size="14px"><tspan x="35" y="12" dy="0em">Electrical Household</tspan><tspan x="35" y="12" dy="1.1em">Appliances</tspan></text><g transform="translate(35,32)"><g class="x axis" transform="translate(0,110)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,6V0.5H175.83333333333334V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Feb 20</text></g><g class="tick" opacity="1" transform="translate(43.76953638598297,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Apr 20</text></g><g class="tick" opacity="1" transform="translate(87.79080203509976,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Jun 20</text></g><g class="tick" opacity="1" transform="translate(131.81206768421654,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Aug 20</text></g><g class="tick" opacity="1" transform="translate(175.83333333333334,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Oct 20</text></g></g><g class="y axis" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M175.33333333333334,110.5H0.5V0.5H175.33333333333334"></path><g class="tick" opacity="1" transform="translate(0,110.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">0</text></g><g class="tick" opacity="1" transform="translate(0,83)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">50</text></g><g class="tick" opacity="1" transform="translate(0,55.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">100</text></g><g class="tick" opacity="1" transform="translate(0,28)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">150</text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">200</text></g></g><path d="M0,55L20.92814268564569,55L43.26953638598297,55L64.91933916423713,55L87.29080203509976,55L108.94060481335391,55L131.31206768421654,55L153.6835305550792,55L175.33333333333334,55" class="linebaseline" stroke="#666" stroke-width="3px"></path><path d="M0,55L20.92814268564569,53.685661755L43.26953638598297,69.862132351L64.91933916423713,65.41360294149999L87.29080203509976,49.590992660000005L108.94060481335391,50.197610319999995L131.31206768421654,51.00643383L153.6835305550792,54.34283090499999L175.33333333333334,47.670036755" class="linelbwregion" stroke="#666" stroke-width="3px"></path></g></svg><svg width="233.33333333333334" height="177" transform="translate(0,0)"><text x="35" y="12" font-weight="700" font-size="14px"><tspan x="35" y="12" dy="0em">Cosmetic &amp; Toilet Articles</tspan></text><g transform="translate(35,32)"><g class="x axis" transform="translate(0,110)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,6V0.5H175.83333333333334V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Feb 20</text></g><g class="tick" opacity="1" transform="translate(43.76953638598297,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Apr 20</text></g><g class="tick" opacity="1" transform="translate(87.79080203509976,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Jun 20</text></g><g class="tick" opacity="1" transform="translate(131.81206768421654,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Aug 20</text></g><g class="tick" opacity="1" transform="translate(175.83333333333334,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Oct 20</text></g></g><g class="y axis" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M175.33333333333334,110.5H0.5V0.5H175.33333333333334"></path><g class="tick" opacity="1" transform="translate(0,110.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,83)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,55.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,28)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g></g><path d="M0,55L20.92814268564569,55L43.26953638598297,55L64.91933916423713,55L87.29080203509976,55L108.94060481335391,55L131.31206768421654,55L153.6835305550792,55L175.33333333333334,55" class="linebaseline" stroke="#666" stroke-width="3px"></path><path d="M0,55L20.92814268564569,53.869475825L43.26953638598297,76.310380267L64.91933916423713,72.01438849L87.29080203509976,60.878725589L108.94060481335391,52.852004095L131.31206768421654,53.926002075L153.6835305550792,49.40390543L175.33333333333334,50.930113025000004" class="linelbwregion" stroke="#666" stroke-width="3px"></path></g></svg><svg width="233.33333333333334" height="177" transform="translate(0,0)"><text x="35" y="12" font-weight="700" font-size="14px"><tspan x="35" y="12" dy="0em">Music and Video</tspan><tspan x="35" y="12" dy="1.1em">Recordings and Equipment</tspan></text><g transform="translate(35,32)"><g class="x axis" transform="translate(0,110)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,6V0.5H175.83333333333334V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Feb 20</text></g><g class="tick" opacity="1" transform="translate(43.76953638598297,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Apr 20</text></g><g class="tick" opacity="1" transform="translate(87.79080203509976,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Jun 20</text></g><g class="tick" opacity="1" transform="translate(131.81206768421654,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Aug 20</text></g><g class="tick" opacity="1" transform="translate(175.83333333333334,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Oct 20</text></g><text transform="translate(175.33333333333334,29)" text-anchor="middle" fill="#666">Year</text></g><g class="y axis" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M175.33333333333334,110.5H0.5V0.5H175.33333333333334"></path><g class="tick" opacity="1" transform="translate(0,110.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,83)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,55.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,28)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g></g><path d="M0,55L20.92814268564569,55L43.26953638598297,55L64.91933916423713,55L87.29080203509976,55L108.94060481335391,55L131.31206768421654,55L153.6835305550792,55L175.33333333333334,55" class="linebaseline" stroke="#666" stroke-width="3px"></path><path d="M0,55L20.92814268564569,61.5139031925L43.26953638598297,76.977342948L64.91933916423713,78.6766220405L87.29080203509976,70.69001029750001L108.94060481335391,61.174047374L131.31206768421654,58.171987643L153.6835305550792,54.60350153500001L175.33333333333334,36.59114316" class="linelbwregion" stroke="#666" stroke-width="3px"></path></g></svg><svg width="233.33333333333334" height="177" transform="translate(0,0)"><text x="35" y="12" font-weight="700" font-size="14px"><tspan x="35" y="12" dy="0em">Specialist Food Stores</tspan></text><g transform="translate(35,32)"><g class="x axis" transform="translate(0,110)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,6V0.5H175.83333333333334V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Feb 20</text></g><g class="tick" opacity="1" transform="translate(43.76953638598297,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Apr 20</text></g><g class="tick" opacity="1" transform="translate(87.79080203509976,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Jun 20</text></g><g class="tick" opacity="1" transform="translate(131.81206768421654,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Aug 20</text></g><g class="tick" opacity="1" transform="translate(175.83333333333334,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Oct 20</text></g></g><g class="y axis" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M175.33333333333334,110.5H0.5V0.5H175.33333333333334"></path><g class="tick" opacity="1" transform="translate(0,110.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">0</text></g><g class="tick" opacity="1" transform="translate(0,83)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">50</text></g><g class="tick" opacity="1" transform="translate(0,55.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">100</text></g><g class="tick" opacity="1" transform="translate(0,28)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">150</text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">200</text></g></g><path d="M0,55L20.92814268564569,55L43.26953638598297,55L64.91933916423713,55L87.29080203509976,55L108.94060481335391,55L131.31206768421654,55L153.6835305550792,55L175.33333333333334,55" class="linebaseline" stroke="#666" stroke-width="3px"></path><path d="M0,55L20.92814268564569,56.710887463999995L43.26953638598297,75.07776761100001L64.91933916423713,71.655992683L87.29080203509976,69.9451052135L108.94060481335391,59.8810613005L131.31206768421654,61.340347667500005L153.6835305550792,56.6102470285L175.33333333333334,54.24519672" class="linelbwregion" stroke="#666" stroke-width="3px"></path></g></svg><svg width="233.33333333333334" height="177" transform="translate(0,0)"><text x="35" y="12" font-weight="700" font-size="14px"><tspan x="35" y="12" dy="0em">Furniture, Lighting etc</tspan></text><g transform="translate(35,32)"><g class="x axis" transform="translate(0,110)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,6V0.5H175.83333333333334V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Feb 20</text></g><g class="tick" opacity="1" transform="translate(43.76953638598297,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Apr 20</text></g><g class="tick" opacity="1" transform="translate(87.79080203509976,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Jun 20</text></g><g class="tick" opacity="1" transform="translate(131.81206768421654,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Aug 20</text></g><g class="tick" opacity="1" transform="translate(175.83333333333334,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Oct 20</text></g></g><g class="y axis" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M175.33333333333334,110.5H0.5V0.5H175.33333333333334"></path><g class="tick" opacity="1" transform="translate(0,110.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,83)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,55.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,28)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g></g><path d="M0,55L20.92814268564569,55L43.26953638598297,55L64.91933916423713,55L87.29080203509976,55L108.94060481335391,55L131.31206768421654,55L153.6835305550792,55L175.33333333333334,55" class="linebaseline" stroke="#666" stroke-width="3px"></path><path d="M0,55L20.92814268564569,66.9692144385L43.26953638598297,97.5636942665L64.91933916423713,89.03927813L87.29080203509976,59.7292993605L108.94060481335391,51.146496830000004L131.31206768421654,50.095541375L153.6835305550792,49.161358785L175.33333333333334,48.227176195" class="linelbwregion" stroke="#666" stroke-width="3px"></path></g></svg><svg width="233.33333333333334" height="177" transform="translate(0,0)"><text x="35" y="12" font-weight="700" font-size="14px"><tspan x="35" y="12" dy="0em">Sports Equipment, Games</tspan><tspan x="35" y="12" dy="1.1em">&amp; Toys</tspan></text><g transform="translate(35,32)"><g class="x axis" transform="translate(0,110)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,6V0.5H175.83333333333334V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Feb 20</text></g><g class="tick" opacity="1" transform="translate(43.76953638598297,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Apr 20</text></g><g class="tick" opacity="1" transform="translate(87.79080203509976,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Jun 20</text></g><g class="tick" opacity="1" transform="translate(131.81206768421654,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Aug 20</text></g><g class="tick" opacity="1" transform="translate(175.83333333333334,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Oct 20</text></g><text transform="translate(175.33333333333334,29)" text-anchor="middle" fill="#666">Year</text></g><g class="y axis" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M175.33333333333334,110.5H0.5V0.5H175.33333333333334"></path><g class="tick" opacity="1" transform="translate(0,110.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,83)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,55.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,28)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em"></text></g></g><path d="M0,55L20.92814268564569,55L43.26953638598297,55L64.91933916423713,55L87.29080203509976,55L108.94060481335391,55L131.31206768421654,55L153.6835305550792,55L175.33333333333334,55" class="linebaseline" stroke="#666" stroke-width="3px"></path><path d="M0,55L20.92814268564569,69.219982469L43.26953638598297,84.066608241L64.91933916423713,81.99386503L87.29080203509976,67.82208589199999L108.94060481335391,62.953549515999995L131.31206768421654,57.602979841L153.6835305550792,53.36108679000001L175.33333333333334,38.90008765499999" class="linelbwregion" stroke="#666" stroke-width="3px"></path></g></svg><svg width="233.33333333333334" height="177" transform="translate(0,0)"><text x="35" y="12" font-weight="700" font-size="14px"><tspan x="35" y="12" dy="0em">All Stores</tspan></text><g transform="translate(35,32)"><g class="x axis" transform="translate(0,110)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle"><path class="domain" stroke="#000" d="M0.5,6V0.5H175.83333333333334V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Feb 20</text></g><g class="tick" opacity="1" transform="translate(43.76953638598297,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Apr 20</text></g><g class="tick" opacity="1" transform="translate(87.79080203509976,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Jun 20</text></g><g class="tick" opacity="1" transform="translate(131.81206768421654,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Aug 20</text></g><g class="tick" opacity="1" transform="translate(175.83333333333334,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">Oct 20</text></g><text transform="translate(175.33333333333334,29)" text-anchor="middle" fill="#666">Year</text></g><g class="y axis" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M175.33333333333334,110.5H0.5V0.5H175.33333333333334"></path><g class="tick" opacity="1" transform="translate(0,110.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">0</text></g><g class="tick" opacity="1" transform="translate(0,83)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">50</text></g><g class="tick" opacity="1" transform="translate(0,55.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">100</text></g><g class="tick" opacity="1" transform="translate(0,28)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">150</text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="175.33333333333334"></line><text fill="#000" x="-3" dy="0.32em">200</text></g></g><path d="M0,55L20.92814268564569,55L43.26953638598297,55L64.91933916423713,55L87.29080203509976,55L108.94060481335391,55L131.31206768421654,55L153.6835305550792,55L175.33333333333334,55" class="linebaseline" stroke="#666" stroke-width="3px"></path><path d="M0,55L20.92814268564569,57.7902439015L43.26953638598297,67.234146342L64.91933916423713,61.9756097565L87.29080203509976,55.3756097565L108.94060481335391,53.22926828999999L131.31206768421654,52.746341449999996L153.6835305550792,51.99512197000001L175.33333333333334,51.297560985000004" class="linelbwregion" stroke="#666" stroke-width="3px"></path></g></svg><svg id="annotationLayer" height="708" width="727" style="background-color: rgba(255, 255, 255, 0); position: absolute; left: 0px; top: 0px;"></svg></div>
<h6 id="source">Source: Office for National Statistics – Monthly Business Survey - Retail Sales Inquiry</h6>

<script src="./d3.min.js(1).download" type="text/javascript"></script>

<script src="./modernizr.svg.min.js.download" type="text/javascript"></script>
<script src="./pym.min.js.download" type="text/javascript"></script>

<script>
    var graphic = d3.select('#graphic');
    var legend = d3.select('#legend');
    var pymChild = null;

    function drawGraphic() {

      maxweek=d3.max(graphic_data,function(d){return d.date})

      var threshold_md = dvc.optional.middleBreakpoint;
      var threshold_sm = dvc.optional.mobileBreakpoint;

      if (parseInt(graphic.style("width")) < threshold_sm) {
        size = "sm";
      } else if (parseInt(graphic.style("width")) < threshold_md) {
        size = "md";
      } else {
        size = "lg";
      }

      categorySort = {}
      if(Array.isArray(dvc.essential.categorySort)){
        for (i = 0; i < dvc.essential.categorySort.length; i++) {
          categorySort[dvc.essential.categorySort[i]] = i;
        }

        graphic_data.sort(function(a, b) {
          return categorySort[a.category] - categorySort[b.category]
        })

        categories=Object.keys(categorySort)
      } else if(dvc.essential.categorySort=="descending"){
        //auto sort the array by biggest value
        graphic_data.filter(function(d){
          return d.date==maxweek
        }).sort(function(a,b){return +b.chiffre - (+a.chiffre)}).forEach(function(item, i){
          categorySort[item.category]=i
        });

        graphic_data.sort(function(a, b) {
          return categorySort[a.category] - categorySort[b.category]
        })

        categories=Object.keys(categorySort)
      } else if (dvc.essential.categorySort=="ascending"){
        graphic_data.filter(function(d){
          return d.date==maxweek
        }).sort(function(a,b){return +a.chiffre - (+b.chiffre)}).forEach(function(item, i){
          categorySort[item.category]=i
        });

        graphic_data.sort(function(a, b) {
          return categorySort[a.category] - categorySort[b.category]
        })

        categories=Object.keys(categorySort)

      }

      var margin = dvc.optional.margin[size]
      var chart_width = parseInt(graphic.style("width")) / dvc.optional.chart_every[size] - margin.left - margin.right;
      var height = Math.ceil((chart_width * dvc.optional.aspectRatio[size][1]) / dvc.optional.aspectRatio[size][0]);

      // clear out existing graphics
      graphic.selectAll("*").remove();
      legend.selectAll("*").remove();

      //draw legend
      legend.append('svg').attr("height", dvc.optional.legendHeight[size]).attr("width", dvc.optional.chart_every[size] * (chart_width + margin.left + margin.right)).append('g')
        .attr('transform', 'translate(5,5)')

//      createLegend();

      function createLegend() {

        var prevX = 0;
        var prevY = 0;
        lineNo = 0;
        var lineNoOld = 0;

        dvc.essential.colour_palette.map(function(d) {
          return d.key
        }).forEach(function(d, i) {

          // draw legend text based on content of var legendLabels ...
          var_group = d3.select("#legend").select('svg').append("g")

          var_group.append("rect")
            .attr("class", "rect" + i)
            .attr("fill", dvc.essential.colour_palette[i].colour)
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", 20)
            .attr("height", 3)

          var_group.append("text")
            .text(dvc.essential.colour_palette[i].key)
            .attr("class", "legend" + i)
            .attr("text-anchor", "start")
            .style("font-size", "12px")
            .style("fill", "#666")
            .attr('y', 6)
            .attr('x', 0);


          d3.selectAll(".legend" + (i))
            .each(calcPosition);

          function calcPosition() {


            var BBox = this.getBBox()


            //prevY =BBox.width
            d3.select(".legend" + (i))
              .attr("y", function(d) {
                if ((prevX + BBox.width + 50) > parseInt(graphic.style("width"))) {
                  lineNoOld = lineNo;
                  lineNo = lineNo + 1;
                  prevX = 0;
                }
                return eval((lineNo * 20) + 20);
              })
              .attr("x", function(d) {
                return prevX + 25;
              })


            d3.select(".rect" + (i))
              .attr("y", function(d) {

                if ((prevX + BBox.width + 50) > parseInt(graphic.style("width"))) {
                  lineNoOld = lineNo;
                  lineNo = lineNo + 1;
                  prevX = 0;
                }

                if (dvc.essential.legendStyle == "rect") {
                  return eval((lineNo * 20) + 5);
                } else {
                  return eval((lineNo * 20) + 12);

                }
              })
              .attr("x", function(d) {
                return prevX;
              })

            prevX = prevX + BBox.width + 50



          }; // end function calcPosition()
        }); // end foreach
        d3.select("#legend").select('svg').style("height","30px")
      } // end function createLegend()

      x = d3.scaleTime()
        .range([0, chart_width]);

      x.domain(d3.extent(graphic_data, function(d) {
        return d.date
      }))

      dates=d3.map(graphic_data,function(d){return d.date}).keys()


      var xAxis = d3.axisBottom(x)
          .tickValues(d3.map(graphic_data,function(d){return d.date}).keys()
          .map(function(d){return d3.timeParse("%a %b %d %Y")(d.match(/\b[\w']+(?:[^\w\n]+[\w']+){1,3}\b/g)[0])})
          .sort(function(a,b){return a - b})
          .filter(function(d,i){
            return i % dvc.optional.x_ticks_every[size] === 0&&i<dates.length-dvc.optional.x_ticks_every[size] || i==dates.length-1 //Rob's fussy comment about labelling the last date
          }))
          .tickFormat(d3.timeFormat("%b %y"))

      line = d3.line()
        .x(function(d) {
          return x(d.date)
        })
        .y(function(d) {
          return y[d.category](d.chiffre)
        })


      nested = d3.nest()
        .key(function(d) {
          return d.category
        })
        .key(function(d) {
          return d.series
        })
        .sortValues(function(a,b) { return a.date - b.date; } )
        .entries(graphic_data)

      //x domain calculations	: zero to intelligent max choice, or intelligent min and max choice,  or interval chosen manually
      y = {}


      if (dvc.essential.yAxisScale == "auto_zero_max_total") {
        var yDomain = [0, d3.max(graphic_data, function(d) {
          return +d.chiffre
        })];
        nested.forEach(function(item, i) {
          y[item.key] = d3.scaleLinear()
            .range([height, 0])
            .domain(yDomain)
            .nice();
        });
      } else if (dvc.essential.yAxisScale == "auto_min_max_total") {
        var yDomain = d3.extent(graphic_data, function(d) {
          return +d.chiffre
        });
        nested.forEach(function(item, i) {
          y[item.key] = d3.scaleLinear()
            .range([height, 0])
            .domain(yDomain)
            .nice();
        });
      } else if (dvc.essential.yAxisScale == "auto_min_max_each") {
        rolledup = d3.nest()
          .key(function(d) {
            return d.category
          })
          .rollup(function(v) {
            return [d3.min(v, function(d) {
              return +d.chiffre
            }), d3.max(v, function(d) {
              return +d.chiffre
            })]
          })
          .entries(graphic_data)

        rolledup.forEach(function(item, i) {
          y[item.key] = d3.scaleLinear()
            .range([height, 0])
            .domain(item.value)
            .nice();
        });

      } else if (dvc.essential.yAxisScale == "auto_zero_max_each") {
        rolledup = d3.nest()
          .key(function(d) {
            return d.category
          })
          .rollup(function(v) {
            return [0, d3.max(v, function(d) {
              return +d.chiffre
            })]
          })
          .entries(graphic_data)

        rolledup.forEach(function(item, i) {
          y[item.key] = d3.scaleLinear()
            .range([height, 0])
            .domain(item.value)
            .nice();
        });

      }



      // sort these hardwired numbers maybe through the dimensions above
      charts = d3.select('#graphic')
        .selectAll('svg')
        .data(nested)
        .enter()
        .append('svg')
        .attr("width", chart_width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("transform", "translate(0,0)")

      charts
        .append('text')
        .attr("x", margin.left)
        .attr("y", 12)
        .text(function(d) {
          return d.key
        })
        .attr('font-weight', 700)
        .attr('font-size', "14px")
        .call(wrap,190);

        // // add in 100 lines
          // d3.select('#graphic').append('line')
          // .attr('x1',-2+x(d3.timeParse(dvc.essential.dateFormat)("01/02/2020")))
          // .attr('x2',2+x(d3.timeParse(dvc.essential.dateFormat)("01/10/2020")))
          // .attr('y1',y(100))
          // .attr('y2',y(100))
          // .attr('stroke','#6d6d6d')
          // .attr('strokewidth',"2px");


      svg = charts
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")

      svg
        .append('g')
        .attr('class', 'x axis')
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis)
        .each(function(d, i) {
          if (i % dvc.optional.chart_every[size] == dvc.optional.chart_every[size] - 1||i==nested.length-1) {
            d3.select(this).append("text")
              .text(dvc.essential.xAxisLabel)
              .attr("transform", "translate(" + chart_width +  "," + (margin.bottom - 6) + ")")
              .attr('text-anchor', 'middle')
              .attr('fill', "#666");
          }
        })

      //create svg for chart

      drawyaxis = svg
        .append('g')
        .attr('class', 'y axis')

      drawyaxis.each(function(d, i) {
        if (i % dvc.optional.chart_every[size] == 0) {
          d3.select(this).call(d3.axisLeft(y[d.key]).tickSize(-chart_width).ticks(3));
        } else {
          d3.select(this).call(d3.axisLeft(y[d.key]).tickSize(-chart_width).tickFormat("").ticks(3))
        }

      })

      svg
        .selectAll('g.line')
        .data(function(d) {
          return d.values;
        })
        .enter()
        .append('path')
        .attr("d", function(d) {
          // console.log(d)
          return line(d.values)
        })
        .attr("class",function(d){return "line"+d.key.replace(/\s/g, '')})
        // .attr("stroke", function(d) {
        //   return dvc.essential.colour_palette.filter(function(e) {
        //     return e.key == d.key
        //   })[0].colour
        // })
        .attr("stroke","#666")
        .attr('stroke-width', "3px")

      // create a big SVG over the top for annotations
      annotationsLayer=d3.select("#graphic")
        .append('svg')
        .attr('id','annotationLayer')
        .attr('height', Math.ceil(nested.length / dvc.optional.chart_every[size]) * (height + margin.top + margin.bottom))
        .attr('width',dvc.optional.chart_every[size]*(chart_width+margin.top+margin.bottom))
        .style('background-color',"rgba(255, 255, 255, 0)")
        .style('position','absolute')
        .style('left', "0px")
        .style('top',"0px") // was 0


        function wrap(text, width) {
       text.each(function() {
         var text = d3.select(this),
           words = text.text().split(/\s+/).reverse(),
           word,
           line = [],
           lineNumber = 0,
           lineHeight = 1.1, // ems
           y = text.attr("y"),
           x = text.attr("x")
           dy = 0,
           tspan = text.text(null).append("tspan").attr("x", x).attr("y", y).attr("dy", dy + "em");
         while (word = words.pop()) {
           line.push(word);
           tspan.text(line.join(" "));
           if (tspan.node().getComputedTextLength() > width) {
             line.pop();
             tspan.text(line.join(" "));
             line = [word];
             tspan = text.append("tspan").attr("x", x).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
           }
         }
       });
     }





      //create link to source
      d3.select('#source')
        .text('Source: ' + dvc.essential.sourceText);

      d3.selectAll(".linelbwregion").raise()

      //use pym to calculate chart dimensions
      if (pymChild) {
        pymChild.sendHeight();
      }
    }


    //check whether browser can cope with svg
    if (Modernizr.svg) {
      //load config
      d3.json("config.json", function(error, config) {
        dvc = config;

        //load chart data
        d3.csv(dvc.essential.graphic_data_url, function(error, data) {
          graphic_data = data;

          graphic_data.forEach(function(d){
            d.date=d3.timeParse(dvc.essential.dateFormat)(d.date)
          })
          //use pym to create iframed chart dependent on specified variables
          pymChild = new pym.Child({
            renderCallback: drawGraphic
          });
        });

      })

    } else {
      //use pym to create iframe containing fallback image (which is set as default)
      pymChild = new pym.Child();
      if (pymChild) {
        pymChild.sendHeight();
      }
    }
  </script>


</body></html>